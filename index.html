<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Graph Editor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.24.0/cytoscape.min.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #cy {
      width: 100%;
      height: 90vh;
      border: 1px solid #ccc;
    }
    #controls {
  padding: 10px;
  background: #f9f9f9;
  position: fixed; /* Keep controls visible on smaller screens */
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  flex-wrap: wrap; /* Adjust for small screens */
  justify-content: space-evenly;
  z-index: 10; /* Ensure it appears above the canvas */
}

    #controls select, #controls button, #controls input {
      margin: 5px;
    }
  </style>
</head>
<body>
  <div id="cy"></div>
  <div id="controls">
    <label for="edgeClass">Edge Class:</label>
    <select id="edgeClass">
      <option value="class1">Class 1</option>
      <option value="class2">Class 2</option>
      <option value="class3">Class 3</option>
    </select>
    <button id="addEdge">Add Edge</button>
    <button id="deleteEdge">Delete Edge</button>
    <button id="save">Save JSON</button>
    <label for="confidenceSlider">Confidence Filter:</label>
    <input type="range" id="confidenceSlider" min="0" max="1" step="0.01" value="0">
    <span id="confidenceValue">0.00</span>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const graphData = {
        elements: {
          nodes: [
{ data: { id: "010N020", label: "I need to be able to have AI act on my work programs", confidence: .9
}, position:{x:131,y:204}}, { data: { id: "011N020", label: "I can’t really scan text well enough to make transferring text back and forth reliable.", confidence: .9
}, position:{x:124,y:475}}, { data: { id: "012N020", label: "Im not sure the policy on github or AI as of today.", confidence: .99
}, position:{x:343,y:547}}, { data: { id: "013N020", label: "having my notes and files separate will make documentation harder", confidence: 0.8
}, position:{x:82,y:477}}, { data: { id: "014N020", label: "I don’t need anyone else to see my second brain", confidence: 0.7
}, position:{x:342,y:444}}, { data: { id: "015N020", label: "AI is my best shot at creating documentation", confidence: 0.95
}, position:{x:168,y:112}}, { data: { id: "010N010", label: "Use local Vault inside working copy app", confidence: 0.9
}, position:{x:30,y:79}}, { data: { id: "012N010", label: "Use blank template for initialization", confidence: 0.9
}, position:{x:150,y:297}}, { data: { id: "015N010", label: "automate push after initial json", confidence: 0.5
}, position:{x:32,y:19}}, { data: { id: "018N010", label: "Use Action button to access list of github pages", confidence: 0.9
}, position:{x:101,y:454}}, { data: { id: "020N010", label: "Explore ways to automate finding the download", confidence: 0.9
}, position:{x:205,y:323}}, { data: { id: "021N010", label: "2 shortcuts, 1 for updating graph, 1 for viewing it", confidence: 0.8
}, position:{x:90,y:45}}, { data: { id: "022N010", label: "Select entire folders?", confidence: 0.5
}, position:{x:158,y:513}}, { data: { id: "023N010", label: "1 note per repo", confidence: 0.5
}, position:{x:198,y:314}}, { data: { id: "024N010", label: "name the download after the repo", confidence: 0.9
}, position:{x:250,y:559}}, { data: { id: "100N010", label: "create GitHub repo with random name and robots.txt", confidence: 0.9
}, position:{x:311,y:529}}, { data: { id: "110N010", label: "clone repo into working copy", confidence: 0.9
}, position:{x:247,y:193}}, { data: { id: "115N010", label: "initialize vault within working copy repo", confidence: 0.9
}, position:{x:315,y:166}}, { data: { id: "116N010", label: "put json in repo to map repo name to vault name?", confidence: 0.5
}, position:{x:107,y:515}}, { data: { id: "117N010", label: "update by taking all md from repo and most recent download with matching name", confidence: 0.9
}, position:{x:243,y:258}} ],
         edges: [{locked:false,position:{x:0,y:0},grabbable:true,data:{id:"4eb5c69f-5640-4c44-b0fd-16a95a04df14",source:"010N010",class:"class1",target:"015"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"96934b27-2518-4d14-bd52-9fe562d809fc",source:"018N010",class:"class1",target:"012"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"8d84256c-846c-4ae4-9000-2473490e3338",source:"018N010",class:"class1",target:"010N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"55b63e09-bf53-4edb-ae83-15314982e3b6",source:"020N010",class:"class1",target:"015N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"ae902d75-48cf-4e30-acb5-ca411fb7d4bc",source:"024N010",class:"class2",target:"020N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"cd11979f-2a8c-44d5-a412-29f2257ed9f6",source:"024N010",class:"class2",target:"023N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"45a01d3f-30a3-4aa9-8ae1-a65aec71fa50",source:"022N010",class:"class2",target:"023N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"c84b1ac6-9eb0-42af-bf58-6a8db2747b96",source:"022N010",class:"class2",target:"010N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"6f38ed1e-eaac-46c5-a5b4-388484f42cbf",source:"023N010",class:"class2",target:"010N010"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"6164e885-7912-488a-8d3f-750d02edd695",source:"021",class:"class1",target:"018"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"f843fb68-a118-4cee-aeeb-3771e317a6c9",source:"110",class:"class1",target:"100"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"944523ef-b1a0-404b-854d-0de56f792376",source:"110",class:"class1",target:"117"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}, {locked:false,position:{x:0,y:0},grabbable:true,data:{id:"95a9d277-f717-487b-9730-fdc802b8f2b2",source:"117",class:"class2",target:"022"},removed:false,selectable:true,selected:false,pannable:true,classes:"",group:"edges"}]
        }
      };
      
      const cy = cytoscape({
        container: document.getElementById("cy"),
        elements: graphData.elements,
        style: [
          {
            selector: "node",
            style: {
              "background-color": "#0074D9",
              label: "data(label)"
            }
          },
          {
            selector: "edge",
            style: {
              "width": 3,
              "line-color": "#FF4136",
              "target-arrow-color": "#FF4136",
              "target-arrow-shape": "triangle",
              label: "data(class)"
            }
          }
        ],
        layout: { name: "preset" }
      });

      const slider = document.getElementById("confidenceSlider");
      const confidenceValue = document.getElementById("confidenceValue");

      slider.addEventListener("input", () => {
        const threshold = parseFloat(slider.value);
        confidenceValue.textContent = threshold.toFixed(2);

        cy.batch(() => {
          cy.nodes().forEach((node) => {
            const confidence = node.data("confidence");
            if (confidence >= threshold) {
              node.show();
            } else {
              node.hide();
            }
          });
        });
      });

      let selectedNodes = [];
      cy.on("tap", "node", (evt) => {
        const node = evt.target;
        if (!selectedNodes.includes(node.id())) {
          selectedNodes.push(node.id());
        }
        if (selectedNodes.length > 2) {
          selectedNodes.shift();
        }
      });

      document.getElementById("addEdge").addEventListener("click", () => {
        if (selectedNodes.length === 2) {
          const edgeClass = document.getElementById("edgeClass").value;
          cy.add({
            group: "edges",
            data: {
              source: selectedNodes[0],
              target: selectedNodes[1],
              class: edgeClass
            }
          });
          selectedNodes = [];
        } else {
          alert("Select two nodes to add an edge.");
        }
      });

      document.getElementById("deleteEdge").addEventListener("click", () => {
        const selectedEdge = cy.edges(":selected");
        if (selectedEdge.length) {
          selectedEdge.remove();
        } else {
          alert("Select an edge to delete.");
        }
      });

      document.getElementById("save").addEventListener("click", () => {
  const updatedData = {
    elements: cy.json().elements
  };
  const jsonText = JSON.stringify(updatedData, null, 2);

  // Generate a timestamp
  const timestamp = new Date().toISOString().replace(/[:-]/g, '').replace('T', '_').split('.')[0];
  const filename = `data_${timestamp}.json`;

  // Create a downloadable link
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(jsonText);
  const dlAnchorElem = document.createElement("a");
  dlAnchorElem.setAttribute("href", dataStr);
  dlAnchorElem.setAttribute("download", filename); // Use the timestamped filename
  dlAnchorElem.click();
});
    });
  </script>
</body>
</html>